# –ò—Ç–æ–≥–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ iOS

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ù–æ–≤—ã–π flow —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–∫–∞–∫ –≤ Telegram –±–æ—Ç–µ)
‚úÖ **AuthView** ‚Üí –í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (Email, –¢–µ–ª–µ—Ñ–æ–Ω, Apple ID)  
‚úÖ **WelcomeScreen** ‚Üí –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–∫–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å")  
‚úÖ **OnboardingView** ‚Üí –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (Name ‚Üí Gender ‚Üí Age ‚Üí Height ‚Üí Weight ‚Üí Activity ‚Üí Goal)  
‚úÖ **MainTabView** ‚Üí –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### 2. –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `Calorigram/Views/Auth/RegistrationMethodView.swift` ‚Üí –í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `Calorigram/Views/Welcome/WelcomeScreen.swift` ‚Üí –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω
- `NEW_REGISTRATION_FLOW.md` ‚Üí –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è flow
- `TEST_NEW_FLOW.md` ‚Üí –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `Calorigram/App/ContentView.swift` ‚Üí –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–æ–≤
- `Calorigram/Views/Auth/AuthView.swift` ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞
- `Calorigram/Views/Auth/EmailAuthView.swift` ‚Üí –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è Login/Register
- `Calorigram/ViewModels/AuthViewModel.swift` ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 4. Backend –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç profile –º–æ–¥—É–ª—è (`app.blocks.profile` ‚Üí `app.api.profile`)  
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `gender` –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è  
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è iOS  
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ credentials

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```swift
isUserRegistered = user.age != nil && user.height != nil && user.weight != nil
```

### –§–ª–∞–≥–∏ AppStorage
- `hasSeenWelcome` ‚Üí –ü–æ–∫–∞–∑–∞–Ω –ª–∏ WelcomeScreen
- `hasCompletedOnboarding` ‚Üí –ó–∞–≤–µ—Ä—à–µ–Ω –ª–∏ Onboarding

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–æ–≤
–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è —Ñ–ª–∞–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ `true`, —á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ Welcome/Onboarding.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –í Xcode
1. Product ‚Üí Clean Build Folder (‚áß‚åòK)
2. Product ‚Üí Build (‚åòB)
3. Product ‚Üí Run (‚åòR)
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ flow
- –ù–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è Welcome ‚Üí Onboarding
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥ ‚Üí —Å—Ä–∞–∑—É MainTabView
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ ‚Üí —Å—Ä–∞–∑—É MainTabView

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ backend
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ Railway –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
```
‚úÖ Created user with ID: X, email: ..., name: ...
‚úÖ Committed user to database. User ID: X
‚úÖ Verified: User X exists in database
```

### 4. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ—Ñ–∏–ª–µ–º
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:
```
üîç Profile update called for user_id: X
üîç Profile data received: {...}
```

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "User not found" –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è Onboarding
**–ü—Ä–∏—á–∏–Ω–∞:** –§–ª–∞–≥–∏ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `resetOnboardingFlagsIfNeeded()`, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Hardcoded –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –º–æ–¥–µ–ª–∏ User
**–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç–∞—Ä–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ –±–µ–∑ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π  
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞, –≤—Å–µ –ø–æ–ª—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ `None` –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## API Endpoints

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/auth/register` ‚Üí –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ email/password
- `POST /api/auth/phone/send-code` ‚Üí –û—Ç–ø—Ä–∞–≤–∫–∞ SMS –∫–æ–¥–∞
- `POST /api/auth/phone/verify` ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ SMS –∫–æ–¥–∞
- `POST /api/auth/apple/login` ‚Üí –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Apple ID

### –ü—Ä–æ—Ñ–∏–ª—å
- `GET /api/profile/me` ‚Üí –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PUT /api/profile` ‚Üí –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- `POST /api/profile/calculate` ‚Üí –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–∞–ª–æ—Ä–∏–∏ –∏ –ë–ñ–£

## –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### users
- `id` (PK) ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ JWT —Ç–æ–∫–µ–Ω–∞—Ö
- `email` ‚Üí Email –¥–ª—è iOS –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `phone_number` ‚Üí –¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è iOS –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `telegram_id` ‚Üí Telegram ID –¥–ª—è Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–º–æ–∂–µ—Ç –±—ã—Ç—å NULL)
- `age`, `height`, `weight`, `gender`, `activity_level`, `goal` ‚Üí –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è

### user_credentials
- `id` (PK)
- `user_id` (FK ‚Üí users.id)
- `email` (UNIQUE)
- `password_hash`

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏ Xcode ‚Üí Console (‚åò‚áßC)
2. –õ–æ–≥–∏ Railway ‚Üí Dashboard ‚Üí Deployments ‚Üí Logs
3. –§–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ
