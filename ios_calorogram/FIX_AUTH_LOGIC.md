# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è WelcomeScreen, —Ö–æ—Ç—è –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è AuthView (–≤—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏).

**–ü—Ä–∏—á–∏–Ω–∞:** –í Keychain –æ—Å—Ç–∞–ª—Å—è —Ç–æ–∫–µ–Ω –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ç–µ—Å—Ç–æ–≤, –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥—É–º–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω.

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. `AuthViewModel.checkAuthStatus()`

**–ë—ã–ª–æ:**
```swift
func checkAuthStatus() {
    isAuthenticated = authService.isLoggedIn()  // –ü—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
}
```

**–°—Ç–∞–ª–æ:**
```swift
func checkAuthStatus() {
    let hasToken = authService.isLoggedIn()
    
    if hasToken {
        // –ï—Å—Ç—å —Ç–æ–∫–µ–Ω - –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ–≥–æ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å, –∑–∞–≥—Ä—É–∂–∞—è –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        Task {
            await loadCurrentUser()  // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ API
        }
    } else {
        // –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
        isAuthenticated = false
        currentUser = nil
    }
}
```

### 2. `AuthViewModel.loadCurrentUser()`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è **—É—Å–ø–µ—à–Ω–∞** ‚Üí `isAuthenticated = true`
- –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ **–Ω–µ—É–¥–∞—á–Ω–∞** (401, 404, –∏ —Ç.–¥.) ‚Üí `isAuthenticated = false` + –æ—á–∏—Å—Ç–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤

**–¢–µ–ø–µ—Ä—å:**
- –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ AuthView

### 3. `ContentView`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```swift
if authViewModel.currentUser == nil {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É, –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
    ProgressView()
}
```

**–ó–∞—á–µ–º:**
- –ò–∑–±–µ–≥–∞–µ–º –º–µ—Ä—Ü–∞–Ω–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
- –î–æ–∂–∏–¥–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –ø—Ä–∏–Ω—è—Ç–∏–µ–º —Ä–µ—à–µ–Ω–∏—è

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã (—Ç–µ–ø–µ—Ä—å)

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞)
```
1. checkAuthStatus() ‚Üí hasToken = false
2. isAuthenticated = false
3. ContentView –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç AuthView ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ï—Å—Ç—å —Ç–æ–∫–µ–Ω, –Ω–æ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π (—Å—Ç–∞—Ä—ã–π —Ç–µ—Å—Ç)
```
1. checkAuthStatus() ‚Üí hasToken = true
2. loadCurrentUser() ‚Üí API error (401/404)
3. isAuthenticated = false, —Ç–æ–∫–µ–Ω—ã –æ—á–∏—â–µ–Ω—ã
4. ContentView –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç AuthView ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ï—Å—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω + –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω
```
1. checkAuthStatus() ‚Üí hasToken = true
2. loadCurrentUser() ‚Üí —É—Å–ø–µ—Ö, user loaded
3. isAuthenticated = true, currentUser != nil
4. isUserRegistered = true (age/height/weight –µ—Å—Ç—å)
5. resetOnboardingFlagsIfNeeded() ‚Üí —Ñ–ª–∞–≥–∏ = true
6. ContentView –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç MainTabView ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ï—Å—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω + –ø—Ä–æ—Ñ–∏–ª—å –ø—É—Å—Ç–æ–π (–Ω–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
```
1. checkAuthStatus() ‚Üí hasToken = true
2. loadCurrentUser() ‚Üí —É—Å–ø–µ—Ö, user loaded
3. isAuthenticated = true, currentUser != nil
4. isUserRegistered = false (age/height/weight = nil)
5. !hasSeenWelcome ‚Üí WelcomeScreen
6. "–ù–∞—á–∞—Ç—å" ‚Üí OnboardingView
7. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Üí MainTabView ‚úÖ
```

## –ö–∞–∫ –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```
1. –í —Å–∏–º—É–ª—è—Ç–æ—Ä–µ - –¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∏–∫–æ–Ω–∫—É
2. –ù–∞–∂–∞—Ç—å "-" (—É–¥–∞–ª–∏—Ç—å)
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–∑ Xcode —Å–Ω–æ–≤–∞
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Reset Content and Settings (—Å–∏–º—É–ª—è—Ç–æ—Ä)
```
1. Device ‚Üí Erase All Content and Settings
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–∑ Xcode —Å–Ω–æ–≤–∞
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å (–¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
```swift
Button("–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ") {
    authViewModel.logout()
    UserDefaults.standard.removeObject(forKey: "hasCompletedOnboarding")
    UserDefaults.standard.removeObject(forKey: "hasSeenWelcome")
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –û—á–∏—Å—Ç–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Xcode (‚åò.)
# –£–¥–∞–ª–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Å–∏–º—É–ª—è—Ç–æ—Ä–∞
# –ò–ª–∏ —Å–±—Ä–æ—Å—å—Ç–µ —Å–∏–º—É–ª—è—Ç–æ—Ä: Device ‚Üí Erase All Content and Settings
```

### 2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ
```bash
Product ‚Üí Clean Build Folder (‚áß‚åòK)
Product ‚Üí Build (‚åòB)
Product ‚Üí Run (‚åòR)
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ flow
```
–ó–∞–ø—É—Å–∫ ‚Üí AuthView (–¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞) ‚úÖ
```

## –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### –ü—Ä–∏ –ü–ï–†–í–û–ú –∑–∞–ø—É—Å–∫–µ:
- –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ ‚Üí AuthView
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí WelcomeScreen ‚Üí Onboarding ‚Üí Main

### –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ:
- –ï—Å—Ç—å —Ç–æ–∫–µ–Ω + –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω ‚Üí Main (—Å—Ä–∞–∑—É)
- –ï—Å—Ç—å —Ç–æ–∫–µ–Ω + –ø—Ä–æ—Ñ–∏–ª—å –ø—É—Å—Ç–æ–π ‚Üí Welcome ‚Üí Onboarding
- –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π ‚Üí AuthView

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–°–º–æ—Ç—Ä–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ Xcode:
```
üîç Loading current user...
‚úÖ User loaded: Name, id: 7
```

–ò–ª–∏ –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π:
```
‚ö†Ô∏è Failed to load current user: unauthorized
```

–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞! –¢–µ–ø–µ—Ä—å –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

