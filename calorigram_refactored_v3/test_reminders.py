"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
"""
import asyncio
import sys
from reminder_sender import send_breakfast_reminders, send_lunch_reminders, send_dinner_reminders, send_test_reminder
from logging_config import get_logger

logger = get_logger(__name__)

async def test_all_reminders():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –≤—Å–µ —Ç–∏–ø—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π"""
    print("\nüß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π...\n")
    
    # –¢–µ—Å—Ç –∑–∞–≤—Ç—Ä–∞–∫–∞
    print("üì® –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ –∑–∞–≤—Ç—Ä–∞–∫–µ...")
    await send_breakfast_reminders()
    print("‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ\n")
    
    await asyncio.sleep(2)
    
    # –¢–µ—Å—Ç –æ–±–µ–¥–∞
    print("üì® –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ–± –æ–±–µ–¥–µ...")
    await send_lunch_reminders()
    print("‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ\n")
    
    await asyncio.sleep(2)
    
    # –¢–µ—Å—Ç —É–∂–∏–Ω–∞
    print("üì® –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ–± —É–∂–∏–Ω–µ...")
    await send_dinner_reminders()
    print("‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ\n")

async def test_single_user(telegram_id: int):
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    print(f"\nüß™ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {telegram_id}...\n")
    result = await send_test_reminder(telegram_id)
    if result:
        print(f"‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {telegram_id}")
    else:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {telegram_id}")

if __name__ == "__main__":
    if len(sys.argv) > 1:
        # –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω telegram_id, —Ç–µ—Å—Ç–∏—Ä—É–µ–º –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        try:
            telegram_id = int(sys.argv[1])
            asyncio.run(test_single_user(telegram_id))
        except ValueError:
            print("‚ùå –û—à–∏–±–∫–∞: —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π telegram_id")
            print("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: python test_reminders.py [telegram_id]")
    else:
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—Å–µ —Ç–∏–ø—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
        asyncio.run(test_all_reminders())
    
    print("\n‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")

